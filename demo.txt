docker network create -d overlay demo

docker login

docker service create --name dbmaster \
--network demo \
--env "MAXREPLICAS=10" \
--restart-condition on-failure \
--with-registry-auth \
frjaraur/docker-pg master


docker service create --name dbslave \
--network demo \
--env "PGPOOLMASTER=dbmaster" \
--restart-condition on-failure \
--with-registry-auth \
frjaraur/docker-pg slave


docker service create --name dbpool \
--network demo \
--env "PGPOOLMASTER=dbmaster" \
--restart-condition on-failure \
--with-registry-auth \
--publish 5432:5432 \
frjaraur/docker-pg pgpool

    
docker service create --name lb \
--network demo \
--env "APPLICATION_ALIAS=app" \
--env "APPLICATION_PORT=3000" \
--restart-condition on-failure \
--with-registry-auth \
--publish 8080:80 \
frjaraur/simplest-demo:simplestlb


docker service create --name app \
--network demo \
--env "dbhost=dbpool" \
--env "dbname=demo" \
--env "dbuser=demo" \
--env "dbpasswd=demo" \
--env "dbpool=true" \
--restart-condition on-failure \
--with-registry-auth \
frjaraur/simplest-demo:simplestapp
